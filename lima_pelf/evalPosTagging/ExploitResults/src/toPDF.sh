#!/bin/sh
## V.HANOKA, juillet 2010.
EVAL_PATH=`dirname $0`
 

#echo "$*"; 
name=$1
shift

res=$(head -11 data/ALL-RESULTS.txt|sed -e 's/\s/~~~/g' -e 's/$/\\\\\\\\/g' );
sum=$(tail -8 data/ALL-RESULTS.txt |sed -e 's/\s/~/g'   -e 's/$/\\\\\\\\/g' );
sed -e "s/==ALL-RES==/`echo $res`/"  -e "s/==SUMMARY==/`echo $sum`/" -e 's/^\\\\//g' $EVAL_PATH/synthese.tex > data/synthese.tex;

for lang in $*; do
    matrix="\\\section{Langue: $lang}
            \\\subsection{Matrice de confusion obtenue pour $lang}
               \\\includegraphics[scale=0.35]{data\/ALL-MATRIX-$lang.png}
               \\\\\\\\\\~\\\\\\\\\\ \\\scriptsize 
            \\\subsubsection{Correspondances tags\/axes de la matrice}
               \\\\ \\\flushleft 
               \\\begin{multicols}{2} ==CORRESP== \\\end{multicols}
            \\\subsection{Liste des 100 premi√®res erreurs de $lang (fr\\\'{e}q. d\\\'{e}croissante)}
               \\\normalsize 
               1ere colonne: fr\\\'{e}quence d'apparition de l'erreur  \\\\\\\\\\
               2eme colonne: tag de r\\\'{e}f\\\'{e}rence  \\\\\\\\\\
               3eme colonne: tag attribu\\\'{e} par LIMA \\\\\\\\\\
               4eme colonne: token concern\\\'{e} \\\\\\\\\\~\\\\\\\\\\
               \\\scriptsize 
               \\n\\\begin{longtable}{l l l l}\\n   ==ERR==  \\n\\\end{longtable} "  

    
    c=$(cat "data/ALL-MATRIX-$lang.corresp" | sed -e 's/^L_//g'  -e 's/_/-/g' -e 's/\$/\\\\\\\\$/'  -e 's/$/~\\\\\\\\\\\\\\\\ /g');
#     er=$(head -100 "data/ALL-ERRORS-$lang.txt" | sed -e 's/^/\\\\\\\\tabenumitem /' -e 's/\t/\\\\n\\\\\\\\tabenumitem /g' -e 's/$/\\\\n\\\\n/' -e 's/%/\\\\\\\\%/g' -e 's/\$/\\\\\\\\$/g' -e 's/_/-/g');
    er=$(head -100 "data/ALL-ERRORS-$lang.txt" | sed -e 's|/|\\\\\\\/|g' -e 's/\t/\\\\\\\&/g' -e 's/$/\\\\\\\\\\\\\\\\\\\\n/' -e 's/%/\\\\\\\\%/g' -e 's/\$/\\\\\\\\$/g' -e 's/_/-/g');
    e=$(echo $matrix |  sed -e "s/==CORRESP==/`echo $c`/" -e "s/==ERR==/`echo $er`/");
    sed -i -e  "s/==MATRIX==/`echo $e`\n&/"  data/synthese.tex;
#     rm err.tmp;
done

sed -i -e "s/==MATRIX==//"  data/synthese.tex; 

pdflatex -interaction=batchmode data/synthese.tex;
mv synthese.pdf $name
rm synthese.aux synthese.log;
echo "Generated $name."
