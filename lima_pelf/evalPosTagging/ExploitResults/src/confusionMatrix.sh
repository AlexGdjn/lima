#!/bin/sh
## V.HANOKA, juillet 2010.

# arg1: langue 
date=$(date);

nbParts=$3
###########################################################
# Classement des tags présents dans le corpus d'entraînement
# par ordre de fréquence croissant:
tags=$(cat ../results.$1.$2/1/10pc.tfcv ../results.$1.$2/1/90pc.tfcv |\
       gawk -F'\t' '{print $2}' |\
       sort | uniq -c | sort -n |\
       gawk -F' ' '{print $2}'| tr '\n' ',');


############################################################
# Extraction de la matrice de confusion (valeurs numériques):
src/matriceConfusion.pl $1 $2 $tags $nbParts > data/ALL-MATRIX-$1.corresp;


###############################################################################
# Construction du graph correspondant (nécessite R et le script MyImagePlot.r):
R --vanilla --slave  <<< "source('src/MyImagePlot.r')
d <- read.table('data/ALL-MATRIX-$1.corresp', header=FALSE)
png('data/ALL-MATRIX-$1.png', width=1600, height=800)
myImagePlot(d, title=c('Confusion Matrix for $1 - $date'))";


# ###########################################################
# # Correspondances:
echo $tags | tr ',' '\n' | cat -n > data/ALL-MATRIX-$1.corresp;

echo "   *  Matrice de confusion pour $1                       ---> data/ALL-MATRIX-$1.png";
echo "   *  Correspondance axes matrice/tags pour $1           ---> data/ALL-MATRIX-$1.corresp";
